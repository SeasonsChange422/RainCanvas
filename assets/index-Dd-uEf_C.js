var A=Object.defineProperty;var O=(n,e,t)=>e in n?A(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>O(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const x=50,b=3,L=.3,S=.2,y="rgba(0,0,0,0.2)",m="rgba(0,0,0,0.1)";class P{constructor(e){h(this,"ctx");this.ctx=e}}class K extends P{constructor(e){super(e)}draw(e,t){for(let s=e.x,i=0;s<this.ctx._width;s+=t*x,i++){let a=i%5==0?y:m;this.drawLine(s,0,s,this.ctx._height,a)}for(let s=e.x,i=0;s>0;s-=t*x,i++){let a=i%5==0?y:m;this.drawLine(s,0,s,this.ctx._height,a)}for(let s=e.y,i=0;s<this.ctx._height;s+=t*x,i++){let a=i%5==0?y:m;this.drawLine(0,s,this.ctx._width,s,a)}for(let s=e.y,i=0;s>0;s-=t*x,i++){let a=i%5==0?y:m;this.drawLine(0,s,this.ctx._width,s,a)}}drawLine(e,t,s,i,a){let l=this.ctx.strokeStyle;this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(s,i),this.ctx.strokeStyle=a,this.ctx.stroke(),this.ctx.strokeStyle=l}}const v="rgb(79,156,238)",k="rgba(79,156,238,0.1)";function M(n){let e={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return n.forEach(t=>{e.minX=Math.min(e.minX,t.x),e.minY=Math.min(e.minY,t.y),e.maxX=Math.max(e.maxX,t.x),e.maxY=Math.max(e.maxY,t.y)}),e}class d extends P{constructor(t,s,i){super(t);h(this,"points");h(this,"isClose");h(this,"isFill");h(this,"fillColor");h(this,"strokeColor");h(this,"isSelected",!1);h(this,"index",0);this.points=s,this.isClose=i.isClose||!1,this.isFill=i.isFill||!1,this.fillColor=i.fillColor||"rgb(255,255,255)",this.strokeColor=i.strokeColor||"rgb(0,0,0)"}isInArea(t,s,i,a){let l=!0;return this.points.map(r=>({x:i.x+r.x*a,y:i.y+r.y*a})).forEach(r=>{(r.x<Math.min(t.x,s.x)||r.x>Math.max(t.x,s.x)||r.y<Math.min(t.y,s.y)||r.y>Math.max(t.y,s.y))&&(l=!1)}),l}isPointInside(t,s,i){if(!this.isClose){let o=M(this.points);return s.x+o.minX*i<=t.x&&s.x+o.maxX*i>=t.x&&s.y+o.minY*i<=t.y&&s.y+o.maxY*i>=t.y}const a=this.points.map(o=>({x:s.x+o.x*i,y:s.y+o.y*i}));let l=!1;const r=a.length;for(let o=0,g=r-1;o<r;g=o++){const c=a[o],p=a[g];if(c.x===t.x&&c.y===t.y)return!0;const X=c.y>t.y!=p.y>t.y,Y=t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x;X&&Y&&(l=!l)}return l}select(){this.isSelected=!0}unselect(){this.isSelected=!1}draw(t,s){let i=this.points.map(a=>({x:t.x+a.x*s,y:t.y+a.y*s}));this.ctx.beginPath(),this.ctx.fillStyle=this.fillColor,this.ctx.strokeStyle=this.isSelected&&this.isClose?v:this.strokeColor,i.forEach((a,l)=>{l===0?this.ctx.moveTo(a.x,a.y):this.ctx.lineTo(a.x,a.y)}),this.isClose&&this.ctx.closePath(),this.isFill&&this.ctx.fill(),this.ctx.stroke(),this.isSelected&&!this.isClose&&this.drawBorder(i)}drawBorder(t){this.index=this.index++%23;let s=M(t);this.ctx.strokeStyle=v,this.ctx.strokeRect(s.minX,s.minY,s.maxX-s.minX,s.maxY-s.minY)}move(t,s){this.points=this.points.map(i=>(i.x+=t,i.y+=s,i))}}class R extends d{constructor(t,s,i){super(t,[],i);h(this,"startPoint");h(this,"endPoint");this.startPoint=s,this.endPoint=s}setEndPoint(t){this.endPoint=t}isPointInside(t,s,i){return!1}draw(t,s){let i=this.startPoint,a=this.endPoint;i!==a&&(this.ctx.fillStyle=this.fillColor,this.ctx.fillRect(i.x,i.y,a.x-i.x,a.y-i.y))}}class f{constructor(e){h(this,"canvas");this.canvas=e}}class w extends f{constructor(){super(...arguments);h(this,"totalOffsetX",0);h(this,"totalOffsetY",0)}handleMousedown(t){let s={x:t.offsetX,y:t.offsetY},i=this.canvas.findShapeAt(s);if(i)switch(t.button){case 0:{this.canvas.selectionManager.singleShape()&&this.canvas.selectionManager.singleSelect(i),this.canvas.selectionManager.has(i)||this.canvas.selectionManager.singleSelect(i),this.canvas.state=new D(this.canvas,s);break}case 2:this.canvas.selectionManager.singleSelect(i)}else t.button===0&&(this.canvas.selectionManager.clear(),this.canvas.state=new F(this.canvas,s))}handleMousemove(t){}handleMouseup(t){}handleMousewheel(t){u(this.canvas,t)}handleKeydown(t){let s=0,i=0;switch(t.key){case"ArrowLeft":{this.totalOffsetX--,s=-1;break}case"ArrowUp":{this.totalOffsetY--,i=-1;break}case"ArrowRight":{this.totalOffsetX++,s=1;break}case"ArrowDown":{this.totalOffsetY++,i=1;break}}this.canvas.selectionManager.move(s,i)}handleKeyup(t){switch(this.canvas.selectionManager.stopMove(),t.key){case"Shift":{this.canvas.selectArea=null;break}}}}class _ extends f{handleMousedown(e){let t={x:e.offsetX,y:e.offsetY},s=this.canvas.findShapeAt(t);s&&this.canvas.selectionManager.toggle(s)}handleMousemove(e){}handleMouseup(e){}handleMousewheel(e){u(this.canvas,e)}handleKeydown(e){switch(e.key){case"z":{this.canvas.commandManager.undo();break}}}handleKeyup(e){}}class I extends f{constructor(){super(...arguments);h(this,"startPoint",{x:0,y:0});h(this,"endPoint",{x:0,y:0})}handleMousedown(t){this.startPoint={x:t.offsetX,y:t.offsetY},console.log(this.startPoint),this.canvas.selectArea=new R(this.canvas.ctx,this.startPoint,{fillColor:k})}handleMousemove(t){this.endPoint={x:t.offsetX,y:t.offsetY},this.canvas.selectArea&&this.canvas.selectArea.setEndPoint(this.endPoint)}handleMouseup(t){this.endPoint={x:t.offsetX,y:t.offsetY},!(!this.startPoint||!this.endPoint)&&(this.canvas.selectionManager.selectArea(this.startPoint,this.endPoint,this.canvas.shapes,this.canvas.originPoint,this.canvas.scale),this.canvas.selectArea=null)}handleMousewheel(t){u(this.canvas,t)}handleKeydown(t){}handleKeyup(t){}}class F extends f{constructor(t,s){super(t);h(this,"startPoint");this.startPoint=s}handleMousedown(t){}handleMousemove(t){t.button===0&&(this.canvas.originPoint.x+=t.offsetX-this.startPoint.x,this.canvas.originPoint.y+=t.offsetY-this.startPoint.y,this.startPoint.x=t.offsetX,this.startPoint.y=t.offsetY)}handleMouseup(t){this.canvas.state=new w(this.canvas)}handleMousewheel(t){u(this.canvas,t)}handleKeydown(t){}handleKeyup(t){}}class D extends f{constructor(t,s){super(t);h(this,"startPoint");this.startPoint=s}handleMousedown(t){}handleMousemove(t){let s=(t.offsetX-this.startPoint.x)/this.canvas.scale,i=(t.offsetY-this.startPoint.y)/this.canvas.scale;this.canvas.selectionManager.move(s,i),this.startPoint.x=t.offsetX,this.startPoint.y=t.offsetY}handleMouseup(t){this.canvas.selectionManager.stopMove(),this.canvas.state=new w(this.canvas)}handleMousewheel(t){u(this.canvas,t)}handleKeydown(t){}handleKeyup(t){}}function u(n,e){let t=n.scale;e.deltaY>0?(n.scale-=S,n.scale=Math.max(L,n.scale)):(n.scale+=S,n.scale=Math.min(b,n.scale)),n.originPoint.x=(n.originPoint.x-e.offsetX)*n.scale/t+e.offsetX,n.originPoint.y=(n.originPoint.y-e.offsetY)*n.scale/t+e.offsetY,e.preventDefault()}class H{}class C extends H{constructor(t,s,i){super();h(this,"shape");h(this,"offsetX");h(this,"offsetY");this.shape=t,this.offsetX=s,this.offsetY=i}execute(){this.shape.move(this.offsetX,this.offsetY)}undo(){this.shape.move(-this.offsetX,-this.offsetY)}}class N{constructor(e){h(this,"selectedShape");h(this,"commandManager");h(this,"totalOffsetX",0);h(this,"totalOffsetY",0);this.selectedShape=new Set,this.commandManager=e}singleSelect(e){this.clear(),this.selectedShape.has(e)||(this.selectedShape.add(e),e.select())}selectArea(e,t,s,i,a){s.forEach(l=>{l.isInArea(e,t,i,a)&&this.toggle(l)})}unselect(e){this.selectedShape.has(e)&&(this.selectedShape.delete(e),e.unselect())}toggle(e){this.selectedShape.has(e)?(this.selectedShape.delete(e),e.unselect()):(this.selectedShape.add(e),e.select())}clear(){this.selectedShape.forEach(e=>{e.unselect()}),this.selectedShape.clear()}has(e){return this.selectedShape.has(e)}move(e,t){let s=[];this.selectedShape.forEach(i=>{s.push(new C(i,e,t))}),this.commandManager.execute(s,!1),this.totalOffsetX+=e,this.totalOffsetY+=t}stopMove(){let e=[];this.selectedShape.forEach(t=>{e.push(new C(t,this.totalOffsetX,this.totalOffsetY))}),this.commandManager.push(e),this.totalOffsetX=0,this.totalOffsetY=0}singleShape(){return this.selectedShape.size<=1}}class T{constructor(){h(this,"history");this.history=[]}push(e){this.history.push(e)}execute(e,t){e.forEach(s=>{s.execute()}),t&&this.history.push(e)}undo(){(this.history.pop()||[]).forEach(t=>{t.undo()})}}function E(n,e){let t=Date.now(),s=null;return function(...i){let a=this;t+e<=Date.now()?(t=Date.now(),n.apply(a,i)):(s&&(clearTimeout(s),s=null),s=setTimeout(()=>{n.apply(a,i)},e))}}class B{constructor(e){h(this,"el");h(this,"ctx");h(this,"width",300);h(this,"height",150);h(this,"scale",1);h(this,"originPoint",{x:20,y:20});h(this,"state");h(this,"multiSelectState");h(this,"areaSelectState");h(this,"normalState");h(this,"shapes",[]);h(this,"selectArea");h(this,"grid");h(this,"selectionManager");h(this,"commandManager");h(this,"throttledMouseHandler",()=>{});h(this,"throttledKeyHandler",()=>{});if(e.el&&typeof e.el=="string"&&(this.el=document.querySelector(e.el)),this.el.getContext&&(this.ctx=this.el.getContext("2d")),isNaN(parseInt(e.width)))throw"width error";if(isNaN(parseInt(e.height)))throw"height error";this.width=e.width,this.height=e.height,this.grid=new K(this.ctx),this.ctx._height=this.height,this.ctx._width=this.width,this.multiSelectState=new _(this),this.areaSelectState=new I(this),this.normalState=new w(this),this.state=this.normalState,this.selectArea=null,this.commandManager=new T,this.selectionManager=new N(this.commandManager),this.resize(this.height,this.width),this.addShape(new d(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new d(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new d(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new d(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new d(this.ctx,[{x:330,y:330},{x:221,y:330},{x:246,y:770},{x:445,y:123}],{isClose:!1,isFill:!1})),this.addShape(new d(this.ctx,[{x:100,y:100},{x:200,y:100},{x:200,y:0}],{isClose:!0,isFill:!0})),this.draw(),this.registerEvent()}handleEvent(e){var s,i;const t=`handle${e.type.charAt(0).toUpperCase()+e.type.slice(1)}`;(i=(s=this.state)[t])==null||i.call(s,e)}handleKeyEvent(e){var s,i;const t=`handle${e.type.charAt(0).toUpperCase()+e.type.slice(1)}`;e.ctrlKey||e.metaKey?this.state=this.multiSelectState:e.shiftKey?this.state=this.areaSelectState:this.state=this.normalState,(i=(s=this.state)[t])==null||i.call(s,e)}registerEvent(){this.throttledMouseHandler=E(this.handleEvent.bind(this),8),this.throttledKeyHandler=E(this.handleKeyEvent.bind(this),32),this.el.addEventListener("mousewheel",this.throttledMouseHandler),this.el.addEventListener("mousedown",this.handleEvent.bind(this)),this.el.addEventListener("mousemove",this.throttledMouseHandler),this.el.addEventListener("mouseup",this.handleEvent.bind(this)),document.addEventListener("keydown",this.throttledKeyHandler),document.addEventListener("keyup",this.throttledKeyHandler),this.el.oncontextmenu=()=>!1}findShapeAt(e){for(let t=this.shapes.length-1;t>=0;t--)if(this.shapes[t].isPointInside(e,this.originPoint,this.scale))return this.shapes[t];return null}draw(e=!0){this.ctx.clearRect(0,0,this.width,this.height),this.grid.draw(this.originPoint,this.scale),this.shapes.forEach(t=>{t.draw(this.originPoint,this.scale)}),this.selectArea&&this.selectArea.draw(this.originPoint,this.scale),window.requestAnimationFrame(()=>{this.draw(e)})}addShape(e){this.shapes.push(e)}resize(e,t){this.el.width=t,this.el.height=e}}let j=new B({el:"#canvas",width:window.innerWidth,height:window.innerHeight});console.log(j);
