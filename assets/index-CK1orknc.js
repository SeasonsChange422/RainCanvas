var C=Object.defineProperty;var P=(n,e,t)=>e in n?C(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>P(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const l of h.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=t(i);fetch(i.href,h)}})();const u=50,L=2,b=.5,S=.2,x="rgba(0,0,0,0.2)",y="rgba(0,0,0,0.1)";class v{constructor(e){a(this,"ctx");this.ctx=e}}class O extends v{constructor(e){super(e)}draw(e,t){for(let s=e.x,i=0;s<this.ctx._width;s+=t*u,i++){let h=i%5==0?x:y;this.drawLine(s,0,s,this.ctx._height,h)}for(let s=e.x,i=0;s>0;s-=t*u,i++){let h=i%5==0?x:y;this.drawLine(s,0,s,this.ctx._height,h)}for(let s=e.y,i=0;s<this.ctx._height;s+=t*u,i++){let h=i%5==0?x:y;this.drawLine(0,s,this.ctx._width,s,h)}for(let s=e.y,i=0;s>0;s-=t*u,i++){let h=i%5==0?x:y;this.drawLine(0,s,this.ctx._width,s,h)}}drawLine(e,t,s,i,h){let l=this.ctx.strokeStyle;this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(s,i),this.ctx.strokeStyle=h,this.ctx.stroke(),this.ctx.strokeStyle=l}}const _="rgb(79,156,238)";class m extends v{constructor(t,s,i){super(t);a(this,"points");a(this,"isClose");a(this,"isFill");a(this,"fillColor");a(this,"strokeColor");a(this,"isSelected",!1);this.points=s,this.isClose=i.isClose||!1,this.isFill=i.isFill||!0,this.fillColor=i.fillColor||"rgb(255,255,255)",this.strokeColor=i.strokeColor||"rgb(0,0,0)"}isPointInside(t,s,i){if(!this.isClose)return!1;const h=this.points.map(c=>({x:s.x+c.x*i,y:s.y+c.y*i}));let l=!1;const o=h.length;for(let c=0,p=o-1;c<o;p=c++){const r=h[c],g=h[p];if(r.x===t.x&&r.y===t.y)return!0;const M=r.y>t.y!=g.y>t.y,E=t.x<(g.x-r.x)*(t.y-r.y)/(g.y-r.y)+r.x;M&&E&&(l=!l)}return l}select(){this.isSelected=!0}unselect(){this.isSelected=!1}draw(t,s){let i=this.points.map(h=>({x:t.x+h.x*s,y:t.y+h.y*s}));this.ctx.beginPath(),this.ctx.fillStyle=this.fillColor,this.ctx.strokeStyle=this.strokeColor,i.forEach((h,l)=>{l===0?this.ctx.moveTo(h.x,h.y):this.ctx.lineTo(h.x,h.y)}),this.isClose&&this.ctx.closePath(),this.isFill&&this.ctx.fill(),this.ctx.stroke(),this.isSelected&&this.drawBorder(i)}drawBorder(t){let s=1/0,i=1/0,h=-1/0,l=-1/0;t.forEach(o=>{s=Math.min(s,o.x),i=Math.min(i,o.y),h=Math.max(h,o.x),l=Math.max(l,o.y),this.ctx.strokeStyle=_,this.ctx.strokeRect(s,i,h-s,l-i)})}move(t,s){this.points=this.points.map(i=>(i.x+=t,i.y+=s,i))}}class d{constructor(e){a(this,"canvas");this.canvas=e}}class w extends d{handleMousedown(e){let t={x:e.offsetX,y:e.offsetY},s=this.canvas.findShapeAt(t);s?(this.canvas.selectionManager.singleShape()&&this.canvas.selectionManager.singleSelect(s),this.canvas.state=new R(this.canvas,t)):e.button===0&&(this.canvas.selectionManager.clear(),this.canvas.state=new A(this.canvas,t))}handleMousemove(e){}handleMouseup(e){}handleMousewheel(e){f(this.canvas,e)}}class X extends d{handleMousedown(e){let t={x:e.offsetX,y:e.offsetY},s=this.canvas.findShapeAt(t);s&&this.canvas.selectionManager.toggle(s)}handleMousemove(e){}handleMouseup(e){}handleMousewheel(e){f(this.canvas,e)}}class Y extends d{handleMousedown(e){}handleMousemove(e){}handleMouseup(e){}handleMousewheel(e){f(this.canvas,e)}}class A extends d{constructor(t,s){super(t);a(this,"startPoint");this.startPoint=s}handleMousedown(t){}handleMousemove(t){t.button===0&&(this.canvas.originPoint.x+=t.offsetX-this.startPoint.x,this.canvas.originPoint.y+=t.offsetY-this.startPoint.y,this.startPoint.x=t.offsetX,this.startPoint.y=t.offsetY)}handleMouseup(t){this.canvas.state=new w(this.canvas)}handleMousewheel(t){f(this.canvas,t)}}class R extends d{constructor(t,s){super(t);a(this,"startPoint");this.startPoint=s}handleMousedown(t){}handleMousemove(t){let s=(t.offsetX-this.startPoint.x)/this.canvas.scale,i=(t.offsetY-this.startPoint.y)/this.canvas.scale;this.canvas.selectionManager.move(s,i),this.startPoint.x=t.offsetX,this.startPoint.y=t.offsetY}handleMouseup(t){this.canvas.state=new w(this.canvas)}handleMousewheel(t){f(this.canvas,t)}}function f(n,e){let t=n.scale;e.deltaY>0?(n.scale-=S,n.scale=Math.max(b,n.scale)):(n.scale+=S,n.scale=Math.min(L,n.scale)),n.originPoint.x=(n.originPoint.x-e.offsetX)*n.scale/t+e.offsetX,n.originPoint.y=(n.originPoint.y-e.offsetY)*n.scale/t+e.offsetY,e.preventDefault()}class I{constructor(){a(this,"selectedShape");this.selectedShape=new Set}singleSelect(e){this.clear(),this.selectedShape.has(e)||(this.selectedShape.add(e),e.select())}unselect(e){this.selectedShape.has(e)&&(this.selectedShape.delete(e),e.unselect())}toggle(e){this.selectedShape.has(e)?(this.selectedShape.delete(e),e.unselect()):(this.selectedShape.add(e),e.select())}clear(){this.selectedShape.forEach(e=>{e.unselect()}),this.selectedShape.clear()}move(e,t){this.selectedShape.forEach(s=>{s.move(e,t)})}singleShape(){return this.selectedShape.size<=1}}class k{constructor(e){a(this,"el");a(this,"ctx");a(this,"width",300);a(this,"height",150);a(this,"scale",1);a(this,"originPoint",{x:20,y:20});a(this,"state");a(this,"shapes",[]);a(this,"grid");a(this,"selectionManager");if(e.el&&typeof e.el=="string"&&(this.el=document.querySelector(e.el)),this.el.getContext&&(this.ctx=this.el.getContext("2d")),isNaN(parseInt(e.width)))throw"width error";if(isNaN(parseInt(e.height)))throw"height error";this.width=e.width,this.height=e.height,this.grid=new O(this.ctx),this.ctx._height=this.height,this.ctx._width=this.width,this.state=new w(this),this.selectionManager=new I,this.resize(this.height,this.width);let t=new m(this.ctx,[{x:33,y:33},{x:77,y:33},{x:77,y:77},{x:33,y:77}],{isClose:!0,isFill:!0}),s=new m(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0});this.addShape(t),this.addShape(s),this.draw(),this.registerEvent()}handleEvent(e){var s,i;const t=`handle${e.type.charAt(0).toUpperCase()+e.type.slice(1)}`;(i=(s=this.state)[t])==null||i.call(s,e)}handleKeyEvent(e){e.ctrlKey||e.metaKey?this.state=new X(this):e.shiftKey?this.state=new Y(this):this.state=new w(this)}registerEvent(){this.el.addEventListener("mousewheel",this.handleEvent.bind(this)),this.el.addEventListener("mousedown",this.handleEvent.bind(this)),this.el.addEventListener("mousemove",this.handleEvent.bind(this)),this.el.addEventListener("mouseup",this.handleEvent.bind(this)),document.addEventListener("keydown",this.handleKeyEvent.bind(this)),document.addEventListener("keyup",this.handleKeyEvent.bind(this))}findShapeAt(e){for(let t=this.shapes.length-1;t>=0;t--)if(this.shapes[t].isPointInside(e,this.originPoint,this.scale))return this.shapes[t];return null}draw(e=!0){this.ctx.clearRect(0,0,this.width,this.height),this.grid.draw(this.originPoint,this.scale),this.shapes.forEach(t=>{t.draw(this.originPoint,this.scale)}),window.requestAnimationFrame(()=>{this.draw(e)})}addShape(e){this.shapes.push(e)}resize(e,t){this.el.width=t,this.el.height=e}}let N=new k({el:"#canvas",width:window.innerWidth,height:window.innerHeight});console.log(N);
