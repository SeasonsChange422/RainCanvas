var O=Object.defineProperty;var b=(h,e,t)=>e in h?O(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var n=(h,e,t)=>b(h,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const u=50,L=3,k=.3,v=.2,x="rgba(0,0,0,0.2)",y="rgba(0,0,0,0.1)";class E{constructor(e){n(this,"ctx");this.ctx=e}}class A extends E{constructor(e){super(e)}draw(e,t){for(let s=e.x,i=0;s<this.ctx._width;s+=t*u,i++){let a=i%5==0?x:y;this.drawLine(s,0,s,this.ctx._height,a)}for(let s=e.x,i=0;s>0;s-=t*u,i++){let a=i%5==0?x:y;this.drawLine(s,0,s,this.ctx._height,a)}for(let s=e.y,i=0;s<this.ctx._height;s+=t*u,i++){let a=i%5==0?x:y;this.drawLine(0,s,this.ctx._width,s,a)}for(let s=e.y,i=0;s>0;s-=t*u,i++){let a=i%5==0?x:y;this.drawLine(0,s,this.ctx._width,s,a)}}drawLine(e,t,s,i,a){let o=this.ctx.strokeStyle;this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(s,i),this.ctx.strokeStyle=a,this.ctx.stroke(),this.ctx.strokeStyle=o}}const S="rgb(79,156,238)";function M(h){let e={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return h.forEach(t=>{e.minX=Math.min(e.minX,t.x),e.minY=Math.min(e.minY,t.y),e.maxX=Math.max(e.maxX,t.x),e.maxY=Math.max(e.maxY,t.y)}),e}class c extends E{constructor(t,s,i){super(t);n(this,"points");n(this,"isClose");n(this,"isFill");n(this,"fillColor");n(this,"strokeColor");n(this,"isSelected",!1);this.points=s,this.isClose=i.isClose||!1,this.isFill=i.isFill||!1,this.fillColor=i.fillColor||"rgb(255,255,255)",this.strokeColor=i.strokeColor||"rgb(0,0,0)"}isPointInside(t,s,i){if(!this.isClose){let l=M(this.points);return s.x+l.minX*i<=t.x&&s.x+l.maxX*i>=t.x&&s.y+l.minY*i<=t.y&&s.y+l.maxY*i>=t.y}const a=this.points.map(l=>({x:s.x+l.x*i,y:s.y+l.y*i}));let o=!1;const w=a.length;for(let l=0,g=w-1;l<w;g=l++){const r=a[l],p=a[g];if(r.x===t.x&&r.y===t.y)return!0;const X=r.y>t.y!=p.y>t.y,Y=t.x<(p.x-r.x)*(t.y-r.y)/(p.y-r.y)+r.x;X&&Y&&(o=!o)}return o}select(){this.isSelected=!0}unselect(){this.isSelected=!1}draw(t,s){let i=this.points.map(a=>({x:t.x+a.x*s,y:t.y+a.y*s}));this.ctx.beginPath(),this.ctx.fillStyle=this.fillColor,this.ctx.strokeStyle=this.isSelected&&this.isClose?S:this.strokeColor,i.forEach((a,o)=>{o===0?this.ctx.moveTo(a.x,a.y):this.ctx.lineTo(a.x,a.y)}),this.isClose&&this.ctx.closePath(),this.isFill&&this.ctx.fill(),this.ctx.stroke(),this.isSelected&&!this.isClose&&this.drawBorder(i)}drawBorder(t){let s=M(t);this.ctx.strokeStyle=S,this.ctx.strokeRect(s.minX,s.minY,s.maxX-s.minX,s.maxY-s.minY)}move(t,s){this.points=this.points.map(i=>(i.x+=t,i.y+=s,i))}}class d{constructor(e){n(this,"canvas");this.canvas=e}}class m extends d{constructor(){super(...arguments);n(this,"totalOffsetX",0);n(this,"totalOffsetY",0)}handleMousedown(t){let s={x:t.offsetX,y:t.offsetY},i=this.canvas.findShapeAt(s);if(i)switch(t.button){case 0:{this.canvas.selectionManager.singleShape()&&this.canvas.selectionManager.singleSelect(i),this.canvas.selectionManager.has(i)||this.canvas.selectionManager.singleSelect(i),this.canvas.state=new R(this.canvas,s);break}case 2:this.canvas.selectionManager.singleSelect(i)}else t.button===0&&(this.canvas.selectionManager.clear(),this.canvas.state=new _(this.canvas,s))}handleMousemove(t){}handleMouseup(t){}handleMousewheel(t){f(this.canvas,t)}handleKeydown(t){let s=0,i=0;switch(t.key){case"ArrowLeft":{this.totalOffsetX--,s=-1;break}case"ArrowUp":{this.totalOffsetY--,i=-1;break}case"ArrowRight":{this.totalOffsetX++,s=1;break}case"ArrowDown":{this.totalOffsetY++,i=1;break}}this.canvas.selectionManager.move(s,i)}handleKeyup(t){this.canvas.selectionManager.stopMove()}}class K extends d{handleMousedown(e){let t={x:e.offsetX,y:e.offsetY},s=this.canvas.findShapeAt(t);s&&this.canvas.selectionManager.toggle(s)}handleMousemove(e){}handleMouseup(e){}handleMousewheel(e){f(this.canvas,e)}handleKeydown(e){switch(e.key){case"z":{this.canvas.commandManager.undo();break}}}handleKeyup(e){}}class P extends d{handleMousedown(e){}handleMousemove(e){}handleMouseup(e){}handleMousewheel(e){f(this.canvas,e)}handleKeydown(e){}handleKeyup(e){}}class _ extends d{constructor(t,s){super(t);n(this,"startPoint");this.startPoint=s}handleMousedown(t){}handleMousemove(t){t.button===0&&(this.canvas.originPoint.x+=t.offsetX-this.startPoint.x,this.canvas.originPoint.y+=t.offsetY-this.startPoint.y,this.startPoint.x=t.offsetX,this.startPoint.y=t.offsetY)}handleMouseup(t){this.canvas.state=new m(this.canvas)}handleMousewheel(t){f(this.canvas,t)}handleKeydown(t){}handleKeyup(t){}}class R extends d{constructor(t,s){super(t);n(this,"startPoint");this.startPoint=s}handleMousedown(t){}handleMousemove(t){let s=(t.offsetX-this.startPoint.x)/this.canvas.scale,i=(t.offsetY-this.startPoint.y)/this.canvas.scale;this.canvas.selectionManager.move(s,i),this.startPoint.x=t.offsetX,this.startPoint.y=t.offsetY}handleMouseup(t){this.canvas.selectionManager.stopMove(),this.canvas.state=new m(this.canvas)}handleMousewheel(t){f(this.canvas,t)}handleKeydown(t){}handleKeyup(t){}}function f(h,e){let t=h.scale;e.deltaY>0?(h.scale-=v,h.scale=Math.max(k,h.scale)):(h.scale+=v,h.scale=Math.min(L,h.scale)),h.originPoint.x=(h.originPoint.x-e.offsetX)*h.scale/t+e.offsetX,h.originPoint.y=(h.originPoint.y-e.offsetY)*h.scale/t+e.offsetY,e.preventDefault()}class F{}class C extends F{constructor(t,s,i){super();n(this,"shape");n(this,"offsetX");n(this,"offsetY");this.shape=t,this.offsetX=s,this.offsetY=i}execute(){this.shape.move(this.offsetX,this.offsetY)}undo(){this.shape.move(-this.offsetX,-this.offsetY)}}class I{constructor(e){n(this,"selectedShape");n(this,"commandManager");n(this,"totalOffsetX",0);n(this,"totalOffsetY",0);this.selectedShape=new Set,this.commandManager=e}singleSelect(e){this.clear(),this.selectedShape.has(e)||(this.selectedShape.add(e),e.select())}unselect(e){this.selectedShape.has(e)&&(this.selectedShape.delete(e),e.unselect())}toggle(e){this.selectedShape.has(e)?(this.selectedShape.delete(e),e.unselect()):(this.selectedShape.add(e),e.select())}clear(){this.selectedShape.forEach(e=>{e.unselect()}),this.selectedShape.clear()}has(e){return this.selectedShape.has(e)}move(e,t){let s=[];this.selectedShape.forEach(i=>{s.push(new C(i,e,t))}),this.commandManager.execute(s,!1),this.totalOffsetX+=e,this.totalOffsetY+=t}stopMove(){let e=[];this.selectedShape.forEach(t=>{e.push(new C(t,this.totalOffsetX,this.totalOffsetY))}),this.commandManager.push(e),this.totalOffsetX=0,this.totalOffsetY=0}singleShape(){return this.selectedShape.size<=1}}class N{constructor(){n(this,"history");this.history=[]}push(e){this.history.push(e)}execute(e,t){e.forEach(s=>{s.execute()}),t&&this.history.push(e)}undo(){(this.history.pop()||[]).forEach(t=>{t.undo()})}}class B{constructor(e){n(this,"el");n(this,"ctx");n(this,"width",300);n(this,"height",150);n(this,"scale",1);n(this,"originPoint",{x:20,y:20});n(this,"state");n(this,"shapes",[]);n(this,"grid");n(this,"selectionManager");n(this,"commandManager");if(e.el&&typeof e.el=="string"&&(this.el=document.querySelector(e.el)),this.el.getContext&&(this.ctx=this.el.getContext("2d")),isNaN(parseInt(e.width)))throw"width error";if(isNaN(parseInt(e.height)))throw"height error";this.width=e.width,this.height=e.height,this.grid=new A(this.ctx),this.ctx._height=this.height,this.ctx._width=this.width,this.state=new m(this),this.commandManager=new N,this.selectionManager=new I(this.commandManager),this.resize(this.height,this.width),this.addShape(new c(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new c(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new c(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new c(this.ctx,[{x:330,y:330},{x:770,y:330},{x:770,y:770},{x:330,y:770}],{isClose:!0,isFill:!0})),this.addShape(new c(this.ctx,[{x:330,y:330},{x:221,y:330},{x:246,y:770},{x:445,y:123}],{isClose:!1,isFill:!1})),this.addShape(new c(this.ctx,[{x:100,y:100},{x:200,y:100},{x:200,y:0}],{isClose:!0,isFill:!0})),this.draw(),this.registerEvent()}handleEvent(e){var s,i;const t=`handle${e.type.charAt(0).toUpperCase()+e.type.slice(1)}`;(i=(s=this.state)[t])==null||i.call(s,e)}handleKeyEvent(e){var s,i;const t=`handle${e.type.charAt(0).toUpperCase()+e.type.slice(1)}`;e.ctrlKey||e.metaKey?this.state=new K(this):e.shiftKey?this.state=new P(this):this.state=new m(this),(i=(s=this.state)[t])==null||i.call(s,e)}registerEvent(){this.el.addEventListener("mousewheel",this.handleEvent.bind(this)),this.el.addEventListener("mousedown",this.handleEvent.bind(this)),this.el.addEventListener("mousemove",this.handleEvent.bind(this)),this.el.addEventListener("mouseup",this.handleEvent.bind(this)),document.addEventListener("keydown",this.handleKeyEvent.bind(this)),document.addEventListener("keyup",this.handleKeyEvent.bind(this)),this.el.oncontextmenu=()=>!1}findShapeAt(e){for(let t=this.shapes.length-1;t>=0;t--)if(this.shapes[t].isPointInside(e,this.originPoint,this.scale))return this.shapes[t];return null}draw(e=!0){this.ctx.clearRect(0,0,this.width,this.height),this.grid.draw(this.originPoint,this.scale),this.shapes.forEach(t=>{t.draw(this.originPoint,this.scale)}),window.requestAnimationFrame(()=>{this.draw(e)})}addShape(e){this.shapes.push(e)}resize(e,t){this.el.width=t,this.el.height=e}}let D=new B({el:"#canvas",width:window.innerWidth,height:window.innerHeight});console.log(D);
